(()=>{"use strict";const t="http://api.tvmaze.com",n=(e,t)=>{const n=document.createElement(e);return n.setAttribute("class",t),n},a=e=>{e.innerHTML=""},i=(e,t)=>{a(t),e.forEach((e=>{const a=n("div","films__img-block fade"),i=n("h2","films__title"),l=n("img","films__img"),o=n("span","icon icon-heart"),{id:s,image:r,name:c}=e;a.setAttribute("data-id",s),i.innerHTML=c,l.setAttribute("src",r?.medium||"../img/no-img.jpg"),l.setAttribute("alt",c||"Unknown"),a.append(i,l,o),function(e,t){localStorage.getItem("favoriteInStorage")&&JSON.parse(localStorage.getItem("favoriteInStorage")).some((t=>t===e))&&t.classList.add("icon-active")}(s,o),t.append(a)}))};let l=1;const o=async e=>{try{if(void 0!==e&&"number"==typeof e){const n=await fetch(`${t}/shows/${e}`);return await n.json()}if(""!==e&&"string"==typeof e){const n=await fetch(`${t}/search/shows?q=${e}`);return await n.json()}{const e=await fetch(`${t}/shows?page=${l}`);return await e.json()}}catch(e){(({status:e})=>{console.log("Error: ",e)})(promise.status)}},s=document.getElementById("inp"),r=document.querySelectorAll(".tabsContent"),c=document.getElementById("filmContainer"),d=document.querySelector(".pagination__current"),m=document.getElementById("serverButton"),g=document.getElementById("genre"),u=document.getElementById("language"),v=document.getElementById("itemsPerPage"),y=document.querySelector(".filter__holder"),f=document.querySelector(".search__return-btn"),p=document.querySelector(".pagination");let _=g.value,S=u.value,E=v.value;const I=()=>{g.value="All",u.value="All",L.genre="All",L.language="All",d.innerText=l,s.value="",h(L)},L={films:[],genre:_,language:S,number:E},h=async(e,t)=>{let l;if(e.films=await o(t),l=e.films.length?(e=>{const t=e.films.map((e=>e.show?e.show:e));return"All"===e.genre&&"All"===e.language?t.slice(0,e.number):"All"!==e.genre&&"All"!==e.language?t.filter((t=>t.genres.includes(e.genre)&&t.language===e.language)).slice(0,e.number):"All"===e.genre&&"All"!==e.language?t.filter((t=>t.language===e.language)).slice(0,e.number):"All"!==e.genre&&"All"===e.language?t.filter((t=>t.genres.includes(e.genre))).slice(0,e.number):void 0})(e):[],l.length)i(l,c);else{a(c);const e=n("div","no-films-msg");e.innerText="No films were found",c.append(e)}},b=()=>{p.style.display="none",f.style.display="inline-block"};f.addEventListener("click",(()=>{I(),v.style.display="block",p.style.display="block",y.style.display="flex",f.style.display="none"})),m.addEventListener("click",(()=>{h(L,s.value),b(),y.style.display="none"})),u.addEventListener("change",(()=>{L.language=u.value,h(L,s.value),b()})),g.addEventListener("change",(async()=>{L.genre=g.value,h(L,s.value),b()})),v.addEventListener("change",(()=>{L.number=v.value,h(L,s.value)})),(()=>{const e=document.getElementById("pagination"),t=document.querySelector(".pagination__drop"),i=document.querySelector(".pagination__holder"),o=document.querySelector(".pagination__prev-btn"),s=document.querySelector(".pagination__next-btn"),r=document.querySelector(".pagination__maximum"),c=t=>{const a=n("li","pagination__item");a.innerText=t,e.append(a)};t.addEventListener("click",(()=>{i.classList.toggle("hidden")})),(()=>{a(e);for(let e=1;e<=10;e++)c(e)})(),o.addEventListener("click",(()=>{l>1&&(l-=1,d.innerText=l,h(L))})),s.addEventListener("click",(()=>{l<10&&(l+=1,d.innerText=l,h(L))})),r.addEventListener("click",(()=>{l=10,d.innerText=l,h(L)})),e.addEventListener("click",(({target:e})=>{e&&e.classList.contains("pagination__item")&&(l=+e.innerText,d.innerText=l,h(L))}))})(),(()=>{const t=document.getElementById("login"),n=document.getElementById("userName"),a=document.getElementById("userPass"),i=document.getElementById("loginBtn"),l=document.getElementById("userLoggedName"),o=document.getElementById("logoutBtn");document.addEventListener("DOMContentLoaded",(()=>{if(localStorage.getItem("userName")){document.documentElement.style.overflow="auto",t.style.display="none";const e=localStorage.getItem("userName");l.innerText=JSON.parse(e),I()}else t.style.display="block"})),i.addEventListener("click",(()=>{n.value.length>2&&a.value.length>2?(localStorage.setItem("userName",JSON.stringify(n.value)),window.location.reload(),t.style.display="none",I()):(e.preventDefault(),n.value="",a.value="")})),o.addEventListener("click",(()=>{window.location.reload(),document.documentElement.style.overflow="hidden",localStorage.removeItem("userName"),t.style.display="block",n.value="",a.value=""}))})(),(()=>{const e=document.getElementById("tabParent"),t=document.querySelectorAll(".header__link"),n=document.getElementsByClassName("tabsContent"),a=()=>{for(let e of n)e.classList.remove("visible","fade"),e.classList.add("hidden");t.forEach((e=>{e.classList.remove("header__link_active","fade")}))},i=(e=1)=>{n[e].classList.remove("hidden"),n[e].classList.add("visible","fade"),t[e].classList.add("header__link_active","fade")};a(),i(),e.addEventListener("click",(e=>{const n=e.target;n&&n.classList.contains("header__link")&&t.forEach(((e,t)=>{n===e&&(a(),i(t))}))}))})(),(()=>{const e=document.getElementById("modal"),t=document.getElementById("modalClose"),i=document.getElementById("modalContent");r.forEach((t=>{t.addEventListener("click",(async({target:t})=>{if(t&&t.classList.contains("films__img")){e.classList.remove("hidden"),e.classList.add("visible");const n=+t.parentNode.getAttribute("data-id"),a=await o(n);s(a)}}))}));const l=()=>{e.classList.remove("visible"),e.classList.add("hidden"),document.body.style.overflow=""};t.addEventListener("click",l),e.addEventListener("click",(t=>{t.target===e&&l()})),document.addEventListener("keydown",(t=>{"Escape"===t.code&&e.classList.contains("visible")&&l()}));const s=e=>{a(i);const t=n("div","modal__title"),l=n("div","modal__main");i.append(t,l);const o=n("img","modal__img"),s=n("div","modal__info"),r=n("div","modal__descr"),c=n("div","modal__genre"),d=n("div","modal__premiere"),m=n("div","modal__rating");t.innerText=e?.name,o.setAttribute("src",e?.image?.medium||"../img/no-img.jpg"),e.summary?r.innerHTML=`${e?.summary.slice(0,600)}...`:r.innerHTML="Unknown",c.innerText=`Genres: ${e?.genres.join(", ")||"Unknown"}`,d.innerText=`Premiere: ${e?.premiered||"Unknown"}`,m.innerText=`Average rating: ${e?.rating?.average||"Unknown"}`,l.append(o,s),s.append(r,c,d,m)}})(),(()=>{const e=document.getElementById("favouriteContainer"),t=document.getElementById("main");localStorage.getItem("favoriteInStorage")||localStorage.setItem("favoriteInStorage",JSON.stringify([])),t.addEventListener("click",(({target:e})=>{if(e&&e.classList.contains("icon-heart")){const t=+e.parentElement.getAttribute("data-id");e.classList.contains("icon-active")?(l(t),e.classList.remove("icon-active"),h(L,s.value)):(n(e,t),r(JSON.parse(localStorage.getItem("favoriteInStorage"))),e.classList.add("icon-active"))}}));const n=async(e,t)=>{const n=await o(t),a=localStorage.getItem("favoriteInStorage");let i=[...JSON.parse(a||JSON.stringify([]))];const l=n?.id;l===+e.parentElement.getAttribute("data-id")&&(i.find((e=>+e===l))||(i=[...i,n.id])),localStorage.setItem("favoriteInStorage",JSON.stringify(i)),r(JSON.parse(localStorage.getItem("favoriteInStorage")))},l=e=>{const t=localStorage.getItem("favoriteInStorage");let n=[...JSON.parse(t||JSON.stringify([]))];const a=n.findIndex((t=>t===e));n.splice(a,1),localStorage.setItem("favoriteInStorage",JSON.stringify(n)),r(JSON.parse(localStorage.getItem("favoriteInStorage")))},r=async t=>{let n=[];for(const e of t){const t=await o(e);n=[...n,t]}a(e),i(n,e)};r(JSON.parse(localStorage.getItem("favoriteInStorage")))})()})();